import { ExcalidrawElement } from "../../element/types";
import { AppState } from "../../types";
import {
  clearAppStateForLocalStorage,
  getDefaultAppState,
} from "../../appState";
import { clearElementsForLocalStorage } from "../../element";
import { STORAGE_KEYS } from "../app_constants";
import { ImportedDataState } from "../../data/types";

export const saveUsernameToLocalStorage = (username: string) => {
  try {
    localStorage.setItem(
      STORAGE_KEYS.LOCAL_STORAGE_COLLAB,
      JSON.stringify({ username }),
    );
  } catch (error: any) {
    // Unable to access window.localStorage
    console.error(error);
  }
};

export const importUsernameFromLocalStorage = (): string | null => {
  try {
    const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);
    if (data) {
      return JSON.parse(data).username;
    }
  } catch (error: any) {
    // Unable to access localStorage
    console.error(error);
  }

  return null;
};

export const importFromLocalStorage = () => {
  let savedElements = null;
  let savedState = null;

  try {
    savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);
    savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);
  } catch (error: any) {
    // Unable to access localStorage
    console.error(error);
  }

  let elements: ExcalidrawElement[] = [];
  if (savedElements) {
    try {
      elements = clearElementsForLocalStorage(JSON.parse(savedElements));
    } catch (error: any) {
      console.error(error);
      // Do nothing because elements array is already empty
    }
  }

  let appState = null;
  if (savedState) {
    try {
      appState = {
        ...getDefaultAppState(),
        ...clearAppStateForLocalStorage(
          JSON.parse(savedState) as Partial<AppState>,
        ),
      };
    } catch (error: any) {
      console.error(error);
      // Do nothing because appState is already null
    }
  }
  return { elements, appState };
};

export const getElementsStorageSize = () => {
  try {
    const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);
    const elementsSize = elements?.length || 0;
    return elementsSize;
  } catch (error: any) {
    console.error(error);
    return 0;
  }
};

export const getTotalStorageSize = () => {
  try {
    const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);
    const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);
    const library = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);

    const appStateSize = appState?.length || 0;
    const collabSize = collab?.length || 0;
    const librarySize = library?.length || 0;

    return appStateSize + collabSize + librarySize + getElementsStorageSize();
  } catch (error: any) {
    console.error(error);
    return 0;
  }
};

export const getLibraryItemsFromStorage = () => {
  try {
    const libraryItems: ImportedDataState["libraryItems"] = JSON.parse(
      localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY) as string,
    );

    return libraryItems || [];
  } catch (error) {
    console.error(error);
    return [];
  }
};

window.onbeforeunload = () => {
  const ls = {
    "excalidraw-theme": "light",
    "excalidraw-state":
      '{"showWelcomeScreen":true,"theme":"light","currentChartType":"bar","currentItemBackgroundColor":"transparent","currentItemEndArrowhead":"arrow","currentItemFillStyle":"hachure","currentItemFontFamily":1,"currentItemFontSize":20,"currentItemOpacity":100,"currentItemRoughness":1,"currentItemStartArrowhead":null,"currentItemStrokeColor":"#000000","currentItemRoundness":"round","currentItemStrokeStyle":"solid","currentItemStrokeWidth":1,"currentItemTextAlign":"left","cursorButton":"up","editingGroupId":null,"activeTool":{"type":"selection","customType":null,"locked":false,"lastActiveTool":null},"penMode":false,"penDetected":false,"exportBackground":true,"exportScale":2,"exportEmbedScene":false,"exportWithDarkMode":false,"gridSize":20,"isSidebarDocked":false,"lastPointerDownWith":"mouse","name":"Untitled-2023-03-08-1535","openMenu":null,"openSidebar":null,"previousSelectedElementIds":{"Rewlxb1Hhl8MQjXLZR1dE":true},"scrolledOutside":false,"scrollX":-3190.2486349438905,"scrollY":1462.476940336679,"selectedElementIds":{"NmiX9fr9mmzTNDsn59XnP":true},"selectedGroupIds":{},"shouldCacheIgnoreZoom":false,"showStats":false,"viewBackgroundColor":"#ffffff","zenModeEnabled":false,"zoom":{"value":1},"selectedLinearElement":null}',
    i18nextLng: "en-GB",
    "version-dataState": "1678272404561",
    excalidraw:
      '[{"type":"ellipse","version":891,"versionNonce":758146926,"isDeleted":false,"id":"htnSdSeIumCNg3Xtc4vaq","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3780,"y":-1200,"strokeColor":"#343a40","backgroundColor":"#ced4da","width":173.53515625,"height":135,"seed":1602922205,"groupIds":[],"roundness":{"type":2},"boundElements":[{"id":"6L_yRPWo9zazBfMyYouwt","type":"arrow"},{"id":"UgBiWERANDDPr2LDdQtKM","type":"arrow"},{"id":"NtT9w-XZJLypTPXuxyD7u","type":"arrow"},{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"id":"_BFRc_U7GL1idpuXjeWun","type":"arrow"},{"id":"juMpMp7UiV_R7ffFvFzl0","type":"arrow"},{"id":"UEVS7QRbarkWpuhKcE94R","type":"arrow"},{"type":"text","id":"Pw_zG__4PT-hvLxN394ZT"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":834,"versionNonce":631063245,"isDeleted":false,"id":"Pw_zG__4PT-hvLxN394ZT","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3857.404791203102,"y":-1171.5581528013552,"strokeColor":"#343a40","backgroundColor":"transparent","width":0,"height":96,"seed":1746148445,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":3,"text":"Directus\\nInstance\\nin a \\ncontainer","textAlign":"center","verticalAlign":"middle","containerId":"htnSdSeIumCNg3Xtc4vaq","originalText":"Directus\\nInstance\\nin a container"},{"type":"rectangle","version":127,"versionNonce":1171081646,"isDeleted":false,"id":"PRknySwa0ruiQajRYFeaA","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5779.205227322049,"y":111.13525099981337,"strokeColor":"#000000","backgroundColor":"transparent","width":992.517333984375,"height":635.5816650390624,"seed":446890387,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":171,"versionNonce":1070067762,"isDeleted":false,"id":"48ZZowI9hNNbw5pKcJGzF","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5715.068264431424,"y":461.08324904668825,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":81376019,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":262,"versionNonce":1964237806,"isDeleted":false,"id":"CpEfqZlCiUjPq2YEhXrPt","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6712.154184492808,"y":461.08324904668825,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":335009971,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":101,"versionNonce":25106930,"isDeleted":false,"id":"TSolYIQZzCO5jPrO6fLcj","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5852.334185887897,"y":730.0291370210188,"strokeColor":"#000000","backgroundColor":"transparent","width":124.88839285714312,"height":31.12601143973211,"seed":1519429043,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":186,"versionNonce":755840558,"isDeleted":false,"id":"n9QX4QcqeyVw1iradJW6A","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6570.437370179191,"y":730.0291370210188,"strokeColor":"#000000","backgroundColor":"transparent","width":124.88839285714312,"height":31.12601143973211,"seed":125269843,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":163,"versionNonce":1579879346,"isDeleted":false,"id":"jxAPTSsyamqZ2SQxNqUfk","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5779.205227322049,"y":-793.1741798037579,"strokeColor":"#000000","backgroundColor":"transparent","width":992.517333984375,"height":635.5816650390624,"seed":1420862931,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":231,"versionNonce":916602990,"isDeleted":false,"id":"v20fCRSvqUki3lj61aE2k","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5625.068264431424,"y":-443.22618175688297,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":2005124061,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":335,"versionNonce":737330546,"isDeleted":false,"id":"IV-WkFiWCmLpntBftWGmJ","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6807.154184492808,"y":-443.22618175688297,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":1077108979,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"FkqI3B4hN5KBvfJlayKxv","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"arrow","version":279,"versionNonce":1436287662,"isDeleted":false,"id":"FkqI3B4hN5KBvfJlayKxv","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6792.392518058655,"y":-311.5421694800971,"strokeColor":"#000000","backgroundColor":"transparent","width":141.16437639508877,"height":0,"seed":2063718141,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"IV-WkFiWCmLpntBftWGmJ","focus":-0.026773725262842076,"gap":14.761666434153085},"endBinding":null,"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"triangle","points":[[0,0],[-141.16437639508877,0]]},{"type":"arrow","version":524,"versionNonce":1679640370,"isDeleted":false,"id":"DOncM18PGp7fVBTsiXBxd","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5898.482431563118,"y":-310.432288760231,"strokeColor":"#000000","backgroundColor":"transparent","width":141.24494280133877,"height":0,"seed":1509805789,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":null,"endBinding":{"focus":0.035427747430232935,"gap":14.472080775667564,"elementId":"v20fCRSvqUki3lj61aE2k"},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":null,"points":[[0,0],[-141.24494280133877,0]]},{"type":"rectangle","version":144,"versionNonce":1822653678,"isDeleted":false,"id":"8t-kYNkFLlGrGA3kv-IED","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5852.483722020709,"y":-174.28029378255246,"strokeColor":"#000000","backgroundColor":"transparent","width":124.88839285714312,"height":31.12601143973211,"seed":62709085,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"d4bSTGEpahOLfbe3VdKi8","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":223,"versionNonce":1058115826,"isDeleted":false,"id":"E9MDg5rFKy9bnCycGYk4l","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6570.437370179191,"y":-174.28029378255246,"strokeColor":"#000000","backgroundColor":"transparent","width":124.88839285714312,"height":31.12601143973211,"seed":1220312669,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"B8R1tvB9N5S4U78R3xLPU","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":271,"versionNonce":557952814,"isDeleted":false,"id":"GE6Jjh6scqg4AqS-g--4z","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5715.068264431424,"y":-442.8353823707224,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":1888704307,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":362,"versionNonce":1347855026,"isDeleted":false,"id":"93rx9lGeS6BfA2rEMEbK6","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6712.154184492808,"y":-442.8353823707224,"strokeColor":"#000000","backgroundColor":"transparent","width":117.7777099609375,"height":256.50054931640625,"seed":2099771603,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":104,"versionNonce":2145360238,"isDeleted":false,"id":"nYuJu0ho0nPHxttTPoBvP","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5743.214902847531,"y":-328.8556431361614,"strokeColor":"#000000","backgroundColor":"transparent","width":10.696377224392563,"height":28.284132215711793,"seed":259546717,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":157,"versionNonce":580090994,"isDeleted":false,"id":"GaYzum7UzW1Lh7ZqVw1yS","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5743.214902847531,"y":-262.4638720315607,"strokeColor":"#000000","backgroundColor":"transparent","width":10.696377224392563,"height":28.284132215711793,"seed":951927411,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":369,"versionNonce":533085102,"isDeleted":false,"id":"TqSKsm_8e4zyf2MimszgW","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5717.451637873573,"y":-215.79144093347043,"strokeColor":"#000000","backgroundColor":"transparent","width":1112.9339938693572,"height":108.92649332682299,"seed":1653949907,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"arrow","version":62,"versionNonce":1401888306,"isDeleted":false,"id":"B8R1tvB9N5S4U78R3xLPU","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":6634.697019546751,"y":-179.71406870039755,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":31.283738878038207,"seed":2130030237,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"E9MDg5rFKy9bnCycGYk4l","focus":0.02907320524278316,"gap":5.433774917845085},"endBinding":null,"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":null,"points":[[0,0],[0,-31.283738878038207]]},{"type":"rectangle","version":123,"versionNonce":1193186798,"isDeleted":false,"id":"3dOmqNuXoDKGb7-PdSlKz","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5865.570839533731,"y":-206.48490203372796,"strokeColor":"#000000","backgroundColor":"transparent","width":9.582349989149407,"height":78.98824055989587,"seed":1800372083,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"rectangle","version":263,"versionNonce":808486898,"isDeleted":false,"id":"j6ElCQHejWT4JA59W21Ea","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5948.995793418279,"y":-206.48490203372796,"strokeColor":"#000000","backgroundColor":"transparent","width":9.582349989149407,"height":78.98824055989587,"seed":1831616573,"groupIds":[],"roundness":{"type":3},"boundElements":[],"updated":1678269987024,"link":null,"locked":false},{"type":"arrow","version":39,"versionNonce":250718254,"isDeleted":false,"id":"d4bSTGEpahOLfbe3VdKi8","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5914.389021916195,"y":-180.838675362721,"strokeColor":"#000000","backgroundColor":"transparent","width":0.09130792499854579,"height":34.8765055338541,"seed":720002931,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"8t-kYNkFLlGrGA3kv-IED","focus":-0.007697566031162894,"gap":6.558381580168543},"endBinding":null,"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":null,"points":[[0,0],[-0.09130792499854579,-34.8765055338541]]},{"type":"rectangle","version":691,"versionNonce":1350482354,"isDeleted":false,"id":"iih9SKXKScfGdCM6HRY3f","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3272.0815232292093,"y":-932.4936843145433,"strokeColor":"#000000","backgroundColor":"transparent","width":359,"height":105,"seed":951952989,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"type":"text","id":"Y6KJuB9PuMRjmyPHS6fs6"},{"id":"XsPVQfTAlfloDPiBYCIZy","type":"arrow"},{"id":"AWr-GkSW8go5YFnjpWdfl","type":"arrow"},{"id":"tQ7KMjQimNpSjdOcXxU9F","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":633,"versionNonce":2145836163,"isDeleted":false,"id":"Y6KJuB9PuMRjmyPHS6fs6","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3451.5815232292093,"y":-917.4936843145433,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":72,"seed":1381159613,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Reddit Scraper\\nRuns at an interval. \\nPopulates db","textAlign":"center","verticalAlign":"middle","containerId":"iih9SKXKScfGdCM6HRY3f","originalText":"Reddit Scraper\\nRuns at an interval. \\nPopulates db"},{"type":"text","version":280,"versionNonce":2078630189,"isDeleted":false,"id":"ICyhGguqXClbHjQ3ghxin","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3292.632721552777,"y":-804.037487211679,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":120,"seed":261514771,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Programmatically query reddit\'s\\nhtml for data.\\n\\nGoogle Cloud Build that runs on\\na scheduled manual trigger.","textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Programmatically query reddit\'s\\nhtml for data.\\n\\nGoogle Cloud Build that runs on\\na scheduled manual trigger."},{"type":"diamond","version":886,"versionNonce":1519121582,"isDeleted":false,"id":"LrvEPUBRhWkfiFzaeBJk6","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3455.075369675376,"y":-1280.7604213896227,"strokeColor":"#000000","backgroundColor":"transparent","width":147,"height":156.24565124511702,"seed":1833626877,"groupIds":[],"roundness":{"type":2},"boundElements":[{"type":"text","id":"eAgZMYWS3BllgcAt0d3pl"},{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"id":"6L_yRPWo9zazBfMyYouwt","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":972,"versionNonce":679367715,"isDeleted":false,"id":"eAgZMYWS3BllgcAt0d3pl","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3527.7896919856034,"y":-1213.137595767064,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":38.4,"seed":1313428637,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":16,"fontFamily":1,"text":"Postgre\\nsDB","textAlign":"center","verticalAlign":"middle","containerId":"LrvEPUBRhWkfiFzaeBJk6","originalText":"PostgresDB"},{"type":"arrow","version":1966,"versionNonce":1925525230,"isDeleted":false,"id":"lCWLdOPvFKWNpNABuzh9q","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3782.1492310644835,"y":-1074.279525245635,"strokeColor":"#000000","backgroundColor":"transparent","width":319.5715202336405,"height":126.82443549489335,"seed":892020125,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":-0.32515680155197624,"gap":23.40937588398407,"elementId":"htnSdSeIumCNg3Xtc4vaq"},"endBinding":{"focus":-0.5099364785980234,"gap":14.961405436198334,"elementId":"iih9SKXKScfGdCM6HRY3f"},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":null,"points":[[0,0],[-319.5715202336405,126.82443549489335]]},{"type":"arrow","version":1746,"versionNonce":1788608242,"isDeleted":false,"id":"6L_yRPWo9zazBfMyYouwt","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3764.7673657400146,"y":-1153.487821413465,"strokeColor":"#000000","backgroundColor":"transparent","width":161.63115177304553,"height":33.16496512212598,"seed":973910333,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"htnSdSeIumCNg3Xtc4vaq","focus":0.0008377269574791004,"gap":18.419137335256067},"endBinding":{"elementId":"LrvEPUBRhWkfiFzaeBJk6","focus":0.008777588048104863,"gap":11.725903137841613},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[-161.63115177304553,-33.16496512212598]]},{"type":"rectangle","version":906,"versionNonce":475865390,"isDeleted":false,"id":"RFyLVRTSoKyhFZMfUW0t1","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3783.37931397499,"y":-932.2952328636505,"strokeColor":"#000000","backgroundColor":"transparent","width":384,"height":105,"seed":2026697213,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"id":"UgBiWERANDDPr2LDdQtKM","type":"arrow"},{"id":"AWr-GkSW8go5YFnjpWdfl","type":"arrow"},{"id":"tXWmJ33vpHMt-JHUVKIX5","type":"arrow"},{"id":"tQ7KMjQimNpSjdOcXxU9F","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":862,"versionNonce":1683665805,"isDeleted":false,"id":"kRsxWateGEVjzesgOyxFE","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3975.37931397499,"y":-891.7952328636505,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":24,"seed":1438100061,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Media Fetch, Format, and Storage","textAlign":"center","verticalAlign":"middle","containerId":null,"originalText":"Media Fetch, Format, and Storage"},{"type":"text","version":564,"versionNonce":713414595,"isDeleted":false,"id":"k9Fuc1Me-31WplKmWE_kt","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3767.0684896802186,"y":-803.8390357607863,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":120,"seed":311210067,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Query Directus for the posts\\nof the day, and fetch all the media.\\n\\nGoogle Cloud Build that runs on\\na scheduled manual trigger.","textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Query Directus for the posts\\nof the day, and fetch all the media.\\n\\nGoogle Cloud Build that runs on\\na scheduled manual trigger."},{"type":"arrow","version":1240,"versionNonce":81422962,"isDeleted":false,"id":"UgBiWERANDDPr2LDdQtKM","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3900.5008408449175,"y":-1057.8232482426724,"strokeColor":"#000000","backgroundColor":"transparent","width":57.265343711405876,"height":108.10507843996379,"seed":1767678365,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.06206380774910815,"gap":11.958991445383774,"elementId":"htnSdSeIumCNg3Xtc4vaq"},"endBinding":{"focus":0.08837803036538944,"gap":17.422936939058104,"elementId":"RFyLVRTSoKyhFZMfUW0t1"},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[57.265343711405876,108.10507843996379]]},{"type":"arrow","version":150,"versionNonce":472722862,"isDeleted":false,"id":"XsPVQfTAlfloDPiBYCIZy","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3068.2294164990662,"y":-875.476940336679,"strokeColor":"#000000","backgroundColor":"transparent","width":181.03843688964844,"height":0,"seed":2070493309,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":null,"endBinding":{"focus":-0.08603321862598627,"gap":22.81366984049464,"elementId":"iih9SKXKScfGdCM6HRY3f"},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"triangle","points":[[0,0],[181.03843688964844,0]]},{"type":"arrow","version":515,"versionNonce":1791511602,"isDeleted":false,"id":"AWr-GkSW8go5YFnjpWdfl","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3651.2752233838323,"y":-875.39521466273,"strokeColor":"#000000","backgroundColor":"transparent","width":118.76853201775384,"height":0.04507149912251407,"seed":1118205331,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.0860332186259863,"gap":20.193700154622547,"elementId":"iih9SKXKScfGdCM6HRY3f"},"endBinding":{"focus":-0.08603321862598627,"gap":13.335558573405024,"elementId":"RFyLVRTSoKyhFZMfUW0t1"},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"triangle","points":[[0,0],[118.76853201775384,0.04507149912251407]]},{"type":"arrow","version":1084,"versionNonce":1037518830,"isDeleted":false,"id":"tQ7KMjQimNpSjdOcXxU9F","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4191.101102290536,"y":-875.2785760788665,"strokeColor":"#000000","backgroundColor":"transparent","width":86.11514151391566,"height":0,"seed":1316164339,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.08603155780540958,"gap":23.721788315545155,"elementId":"RFyLVRTSoKyhFZMfUW0t1"},"endBinding":{"focus":-0.08981158544146249,"gap":24.967409769694314,"elementId":"S1htl3r3YfQjV_n8NZ-k1"},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"triangle","points":[[0,0],[86.11514151391566,0]]},{"type":"rectangle","version":1121,"versionNonce":605287922,"isDeleted":false,"id":"S1htl3r3YfQjV_n8NZ-k1","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4302.183653574146,"y":-932.4936843145433,"strokeColor":"#000000","backgroundColor":"transparent","width":384,"height":105,"seed":160094173,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"id":"UgBiWERANDDPr2LDdQtKM","type":"arrow"},{"id":"AWr-GkSW8go5YFnjpWdfl","type":"arrow"},{"id":"tQ7KMjQimNpSjdOcXxU9F","type":"arrow"},{"id":"tXWmJ33vpHMt-JHUVKIX5","type":"arrow"},{"id":"juMpMp7UiV_R7ffFvFzl0","type":"arrow"},{"type":"text","id":"H_gaod8pgjJazsXWtYh8r"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":1123,"versionNonce":188135917,"isDeleted":false,"id":"H_gaod8pgjJazsXWtYh8r","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4494.183653574146,"y":-892.4936843145433,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":24,"seed":1165874237,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"NodeJS Video Creator","textAlign":"center","verticalAlign":"middle","containerId":"S1htl3r3YfQjV_n8NZ-k1","originalText":"NodeJS Video Creator"},{"type":"diamond","version":897,"versionNonce":298084274,"isDeleted":false,"id":"w1VyN_77Dp4e78FFWfbqC","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3836.996615334166,"y":-1466.5755104791524,"strokeColor":"#000000","backgroundColor":"transparent","width":129.8773193359375,"height":129.8773193359375,"seed":1257789363,"groupIds":[],"roundness":{"type":2},"boundElements":[{"id":"NtT9w-XZJLypTPXuxyD7u","type":"arrow"},{"type":"text","id":"7SBVELlcS9tKcG3fTEYzc"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":869,"versionNonce":1947985763,"isDeleted":false,"id":"7SBVELlcS9tKcG3fTEYzc","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3901.9659451681505,"y":-1411.206180645168,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":38.4,"seed":874047827,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164089,"link":null,"locked":false,"fontSize":16,"fontFamily":1,"text":"Templa\\ntes","textAlign":"center","verticalAlign":"middle","containerId":"w1VyN_77Dp4e78FFWfbqC","originalText":"Templates"},{"type":"arrow","version":2084,"versionNonce":1543545202,"isDeleted":false,"id":"NtT9w-XZJLypTPXuxyD7u","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3884.260477989382,"y":-1219.4812439410614,"strokeColor":"#000000","backgroundColor":"transparent","width":8.986694845731108,"height":106.25782541982676,"seed":1384904093,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.11657167895590549,"gap":20.657896604216404,"elementId":"htnSdSeIumCNg3Xtc4vaq"},"endBinding":{"focus":0.03494206220442528,"gap":13.985187503372146,"elementId":"w1VyN_77Dp4e78FFWfbqC"},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[8.986694845731108,-106.25782541982676]]},{"type":"rectangle","version":365,"versionNonce":1525278382,"isDeleted":false,"id":"xMKtryvXXcuf2592O8baY","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3641.2639209807908,"y":-1445.2578105018226,"strokeColor":"#000000","backgroundColor":"transparent","width":85.94291687011719,"height":126.22611999511719,"seed":38746237,"groupIds":[],"roundness":{"type":3},"boundElements":[{"id":"_BFRc_U7GL1idpuXjeWun","type":"arrow"},{"type":"text","id":"-g8fYhV52jQMKykC9tNGL"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":253,"versionNonce":1501754445,"isDeleted":false,"id":"-g8fYhV52jQMKykC9tNGL","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3684.2353794158494,"y":-1391.744750504264,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":19.2,"seed":2104461971,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164090,"link":null,"locked":false,"fontSize":16,"fontFamily":1,"text":"S3","textAlign":"center","verticalAlign":"middle","containerId":"xMKtryvXXcuf2592O8baY","originalText":"S3"},{"type":"arrow","version":761,"versionNonce":1452597486,"isDeleted":false,"id":"_BFRc_U7GL1idpuXjeWun","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":3733.9814734868182,"y":-1306.019488103566,"strokeColor":"#000000","backgroundColor":"transparent","width":76.84682707318416,"height":108.32150577718585,"seed":1124307517,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"xMKtryvXXcuf2592O8baY","focus":0.04854541306433987,"gap":14.670143127441406},"endBinding":{"elementId":"htnSdSeIumCNg3Xtc4vaq","focus":-0.09773186902082161,"gap":11.717131808882883},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[76.84682707318416,108.32150577718585]]},{"type":"arrow","version":1124,"versionNonce":844655858,"isDeleted":false,"id":"tXWmJ33vpHMt-JHUVKIX5","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4707.2624016413665,"y":-875.476940336679,"strokeColor":"#000000","backgroundColor":"transparent","width":93.43934195382099,"height":0,"seed":1886390579,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.08603321862598633,"gap":21.19645872570254,"elementId":"S1htl3r3YfQjV_n8NZ-k1"},"endBinding":null,"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"triangle","points":[[0,0],[93.43934195382099,0]]},{"type":"text","version":315,"versionNonce":730792707,"isDeleted":false,"id":"wV3yoMAiwwSQUPurBscCT","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4310.16986580501,"y":-805.398601168675,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":120,"seed":1646617597,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164090,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Query Directus for the posts, templates and media data.\\nCompile JS, execute and output a video.\\n\\nGoogle Cloud Build that runs on\\na manual trigger after the daily content is approved.","textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Query Directus for the posts, templates and media data.\\nCompile JS, execute and output a video.\\n\\nGoogle Cloud Build that runs on\\na manual trigger after the daily content is approved."},{"type":"arrow","version":397,"versionNonce":1851915954,"isDeleted":false,"id":"juMpMp7UiV_R7ffFvFzl0","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4456.763992464936,"y":-948.523823511032,"strokeColor":"#000000","backgroundColor":"transparent","width":488.76974876705026,"height":162.9759613586424,"seed":1335523347,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"focus":0.4810551275133763,"gap":16.030139196488676,"elementId":"S1htl3r3YfQjV_n8NZ-k1"},"endBinding":{"focus":-0.17365300868105066,"gap":17.682955478371085,"elementId":"htnSdSeIumCNg3Xtc4vaq"},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[-488.76974876705026,-162.9759613586424]]},{"type":"rectangle","version":1285,"versionNonce":533200238,"isDeleted":false,"id":"6XjlhYiD6g7_C6874Vk58","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4839.590705750485,"y":-922.740440731954,"strokeColor":"#000000","backgroundColor":"transparent","width":384,"height":85,"seed":1547057245,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"6HcE44swkTUmh4CVieuca"},{"id":"lCWLdOPvFKWNpNABuzh9q","type":"arrow"},{"id":"UgBiWERANDDPr2LDdQtKM","type":"arrow"},{"id":"AWr-GkSW8go5YFnjpWdfl","type":"arrow"},{"id":"tQ7KMjQimNpSjdOcXxU9F","type":"arrow"},{"id":"tXWmJ33vpHMt-JHUVKIX5","type":"arrow"},{"id":"juMpMp7UiV_R7ffFvFzl0","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":1315,"versionNonce":1528357549,"isDeleted":false,"id":"6HcE44swkTUmh4CVieuca","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":5031.590705750485,"y":-892.740440731954,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":24,"seed":1223310323,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164090,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"Upload to Youtube","textAlign":"center","verticalAlign":"middle","containerId":"6XjlhYiD6g7_C6874Vk58","originalText":"Upload to Youtube"},{"type":"diamond","version":1199,"versionNonce":1828855726,"isDeleted":false,"id":"7AkIFsDqG5iWmZ0i8pK1g","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4012.4802753509066,"y":-1400.0389940170987,"strokeColor":"#000000","backgroundColor":"transparent","width":129.8773193359375,"height":129.8773193359375,"seed":387563997,"groupIds":[],"roundness":{"type":2},"boundElements":[{"type":"text","id":"QlD96gehe6k7120xmdf68"},{"id":"NtT9w-XZJLypTPXuxyD7u","type":"arrow"},{"id":"UEVS7QRbarkWpuhKcE94R","type":"arrow"}],"updated":1678269987024,"link":null,"locked":false},{"type":"text","version":1176,"versionNonce":694004387,"isDeleted":false,"id":"QlD96gehe6k7120xmdf68","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4077.4189350188753,"y":-1345.60033434913,"strokeColor":"#000000","backgroundColor":"transparent","width":0,"height":38.4,"seed":268291539,"groupIds":[],"roundness":null,"boundElements":[],"updated":1678272164090,"link":null,"locked":false,"fontSize":16,"fontFamily":1,"text":"Thumb\\nnails","textAlign":"center","verticalAlign":"middle","containerId":"7AkIFsDqG5iWmZ0i8pK1g","originalText":"Thumbnails"},{"type":"arrow","version":755,"versionNonce":1262352878,"isDeleted":false,"id":"UEVS7QRbarkWpuhKcE94R","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":0,"opacity":100,"angle":0,"x":4032.4777072036723,"y":-1304.314649802096,"strokeColor":"#000000","backgroundColor":"transparent","width":94.95254219869184,"height":102.51622217683075,"seed":1309717651,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1678269987024,"link":null,"locked":false,"startBinding":{"elementId":"7AkIFsDqG5iWmZ0i8pK1g","focus":0.25296058002661587,"gap":7.628446637271317},"endBinding":{"elementId":"htnSdSeIumCNg3Xtc4vaq","focus":0.06145204029131662,"gap":23.091014303914534},"lastCommittedPoint":null,"startArrowhead":"triangle","endArrowhead":"triangle","points":[[0,0],[-94.95254219869184,102.51622217683075]]}]',
    "version-files": "1678272404562",
  };
  localStorage.setItem("excalidraw", ls["excalidraw"]);
  localStorage.setItem("excalidraw-state", ls["excalidraw-state"]);
};
